<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Indonesian CSLSA Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
body, html { margin:0; padding:0; height:100%; }
#map { width:100%; height:100%; }
#panel {
    position: absolute;
    top: 10px; left: 10px;
    background: white;
    padding: 12px;
    z-index: 1000;
    border-radius: 6px;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
}
#errorBox {
    position: absolute;
    bottom: 10px;
    left: 10px;
    background: #ffcccc;
    padding: 8px;
    display: none;
    border: 1px solid #cc0000;
    z-index: 2000;
}
</style>
</head>

<body>

<div id="panel">
    <b>Variable:</b><br>
    <select id="variable">
        <option value="suitability_index">Suitability Index</option>
        <option value="suitability_class">Suitability Class</option>
        <option value="mem_temp">MEM Temp</option>
        <option value="mem_precip">MEM Precip</option>
        <option value="mem_soilN">MEM SoilN</option>
        <option value="mem_sw">MEM Soil Water</option>
        <option value="mem_elev">MEM Elevation</option>
        <option value="mem_slope">MEM Slope</option>
    </select>
    <br><br>

    <button onclick="loadTiles()">Load Layer</button>
</div>

<div id="map"></div>
<div id="errorBox"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

var map = L.map('map', { center: [-3, 119], zoom: 4, minZoom: 0, maxZoom: 5 });

var osm = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);

var satellite = L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{x}/{y}",
    { maxZoom: 19 }
);

var activeLayer = null;

function loadTiles() {
    let variable = document.getElementById("variable").value;

    // <<=== FIXED HERE
    let urlTemplate = `tiles/${variable}/{z}/{x}_{y}.png`;

    console.log("Loading:", urlTemplate);

    if (activeLayer) map.removeLayer(activeLayer);

    activeLayer = L.tileLayer(urlTemplate, {
        minZoom: 0,
        maxZoom: 5
    }).addTo(map);

    activeLayer.on("tileerror", function(e) {
        let box = document.getElementById("errorBox");
        box.style.display = "block";
        box.innerHTML = "âš  ERROR: Tile not found:<br>" + e.tile.src;
        console.error("Missing tile:", e.tile.src);
    });

    document.getElementById("errorBox").style.display = "none";
}

L.control.layers(
    { "OpenStreetMap": osm, "Satellite": satellite },
    {}
).addTo(map);

</script>

</body>
</html>
